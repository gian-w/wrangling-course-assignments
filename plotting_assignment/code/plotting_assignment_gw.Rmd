---
title: "Plotting Assignment - "
author: "Gian Wegmueller"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    code_folding: show
    highlight: haddock
    theme: flatly
    toc: yes
    toc_float: yes
---

```{r, include=FALSE}

# set knit options
knitr::opts_chunk$set(message = FALSE,
                      warning = FALSE)

# disable scientific notation
options(scipen = 999) 


```

# Dependencies

```{r}

# update dependencies -> only include necessary packages

library(readr)
library(dplyr)
library(tidyr)
library(janitor)
library(stringr)
library(trackeR)
library(ggplot2)


library(datasauRus) 
library(scales)

library(plotrix) 
library(ThemePark)
library(patchwork)

library(knitr)
library(kableExtra)

```


# Data exploration (temporary, should not be included in final file)

```{r Data exploration}
## Drug use data
drugs_raw <- read_csv("../data/drug_use_by_age.csv")

summary(drugs_raw)

```

## Data Preparation Drug Use

```{r Data prep}
drugs_comparison <- drugs_raw %>% 
  select(age, n, 
         starts_with(c("alcohol", "marijuana", "cocaine", "meth"))) %>% 
  filter(age %in% c("21", "22-23", "24-25", "26-29", "50-64")) %>% #choosing only legal drinking-age millenials for comparison here!
  mutate(cocaine_frequency = as.numeric(cocaine_frequency),
         meth_frequency = as.numeric(meth_frequency),
         generation = if_else(age == "50-64", "Boomers", "Millennials")) %>% 
  group_by(generation) %>% 
  summarize(alcohol = janitor::round_half_up(weighted.mean(alcohol_frequency, n), 1),
            marijuana = janitor::round_half_up(weighted.mean(marijuana_frequency, n), 1),
            cocaine = janitor::round_half_up(weighted.mean(cocaine_frequency, n), 1),
            methamphetamin = janitor::round_half_up(weighted.mean(meth_frequency, n), 1)) %>% 
  pivot_longer(cols = alcohol:methamphetamin,
               names_to = "drug",
               values_to = "median_freq") %>% 
    mutate(drug = stringr::str_to_title(drug))# str_to_title from stringr capitalizes the first letter of every string in a character vector (or character object in this case)

```

## Data Visualization Median Use Frequency

```{r Visualization}
# Bad plot for visualizing median use frequency of 4 different drugs by generation (Boomers & Millennials)
drug_use_plot <- ggplot(data = drugs_comparison,
                 aes(x = median_freq,
                     y = drug,
                     colour = generation)) +
  
  geom_bin_2d(position = "jitter", 
              binwidth = 5,
              fill = "#FF5F1F",
              show.legend = TRUE) +
  
  geom_line(mapping = aes(group = generation),
            size = .2) +
  
  scale_colour_manual(values = c("#00BFFF", "#00827F")) + 
  
  scale_x_continuous(breaks = seq(0, 60, 2.5),
                     limits = c(0, 60)) +
  
  labs(title = "Median Use Frequency last 12 Months by Generation",
       x = "Median Use Frequency last 12 Months", 
       y = "Drug",
       colour = "Generation") +
  
  theme_classic()
  


drug_use_plot
```








```{r}
lucerne_half_24 <- readTCX("../data/lucerne_half_2024.tcx")


```


# Session info

```{r}

sessionInfo()

```
